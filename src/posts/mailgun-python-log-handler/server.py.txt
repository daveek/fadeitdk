import logging
from flask import Flask
from mailgun_handler import MailgunHandler

app = Flask(__name__)
# Setup logging handler
mail_handler = MailgunHandler(
    api_url='https://api.mailgun.net/v3/fadeit.dk/messages',
    api_key='secret',
    sender='noreply@fadeit.dk',
    recipients=['ss@fadeit.dk', 'ja@fadeit.dk'],
    subject='Application error!'
)
mail_handler.setLevel(logging.ERROR)
mail_handler.setFormatter(logging.Formatter('''
    Message type:       %(levelname)s
    Location:           %(pathname)s:%(lineno)d
    Module:             %(module)s
    Function:           %(funcName)s
    Time:               %(asctime)s
    
    Message:
    
    %(message)s
'''))
app.logger.addHandler(mail_handler)

@app.route('/error')
def error():
    raise Exception("Beds are burning!")
        
if __name__ == '__main__':
    #app.run(debug=True) #Handler isn't executed if app is run in debug mode
    app.run()
